(()=>{"use strict";const t={blocks:{header:document.querySelector(".app__header"),content:document.querySelector(".app__content"),footer:document.querySelector(".app__footer"),get textInput(){return this.header.querySelector("input")},get toggleAllButton(){return this.content.querySelector(".app__toggle-all")},get itemsList(){return this.content.querySelector(".app__items-list")},get itemsLeft(){return this.footer.querySelector("p")},get buttons(){return this.footer.querySelector(".app__buttons")},get clearButton(){return this.footer.querySelector(".app__clear-button")}},filter:"all",items:[],isShow:!1},e=(t,e)=>{const o=document.createElement(t);return o.classList.add(e),o},o=t=>{const{content:e,footer:o}=t.blocks;[e,o].forEach((t=>t.classList.toggle(t.classList[0]+"_show"))),t.isShow=!t.isShow},s=({blocks:t,items:e})=>{const{itemsLeft:o}=t,s=(t=>t.filter((t=>!t.isCompleted)).length)(e);o.textContent=`${s} ${1===s?"item":"items"} left`},i=({blocks:t,filter:e,items:o})=>{const s=t.itemsList;if(Array.from(s.childNodes).forEach((t=>t.remove())),"all"===e)s.prepend(...n(o));else{const t=o.filter((t=>"completed"===e?t.isCompleted:!t.isCompleted));s.prepend(...n(t))}},r=(t,e)=>{setTimeout(t,500,e)},n=n=>n.map((n=>(n=>{const l=e("li","item");l.id=n.time,l.isCompleted=n.isCompleted,l.insertAdjacentHTML("afterbegin",'<div class="item__template">\n        <input id="item-checkbox" type="checkbox">\n        <label class="item__checkbox" for="item-checkbox"></label>\n        <label class="item__content"></label>\n        <button class="item__button" type="button">+</button>\n    </div>\n    <div class="item__edit">\n        <input type="text">\n    </div>');const c=l.querySelector("#item-checkbox"),a=l.querySelector(".item__checkbox"),d=l.querySelector(".item__content"),m=l.querySelector(".item__button"),u=l.querySelector(".item__edit input");return l.isCompleted&&(l.classList.add("item_completed"),c.checked=!0),c.id+=`_${n.time}`,a.htmlFor+=`_${n.time}`,d.textContent=n.text,a.addEventListener("click",(e=>{(({target:t},{items:e})=>{const o=t.closest(".item");o.classList.toggle("item_completed"),o.isCompleted=!o.isCompleted,e.filter((t=>t.time===parseInt(o.id))).forEach((t=>t.isCompleted=!t.isCompleted))})(e,t),s(t),r(i,t)})),d.addEventListener("dblclick",(t=>{(({target:t})=>{const e=t.closest(".item");e.classList.add("item_edited");const o=e.querySelector(".item__content"),s=e.querySelector(".item__edit input");s.value=o.textContent,s.focus()})(t)})),m.addEventListener("click",(e=>{(({target:t},e)=>{const o=t.closest(".item");e.items.splice(0,e.items.length,...e.items.filter((t=>t.time!==parseInt(o.id)))),o.remove()})(e,t),s(t),i(t),t.isShow&&0===t.items.length&&o(t)})),u.addEventListener("blur",(e=>{(({target:t},e)=>{const o=t.closest(".item");t.value.trim()?(o.querySelector(".item__content").textContent=t.value,e.items.find((t=>t.time===parseInt(o.id))).text=t.value):(e.items.splice(0,e.items.length,...e.items.filter((t=>t.time!==parseInt(o.id)))),o.remove()),o.classList.remove("item_edited")})(e,t),s(t),i(t),t.isShow&&0===t.items.length&&o(t)})),u.addEventListener("keydown",(t=>{(({key:t,target:e})=>{if("Enter"===t&&e.blur(),"Escape"===t){const t=e.closest(".item").querySelector(".item__content");e.value=t.textContent,e.blur()}})(t)})),l})(n)));class l{constructor(t){this.isCompleted=!1,this.text=t,this.time=Date.now(),this.date=new Date}}const{textInput:c,toggleAllButton:a,buttons:d,clearButton:m}=t.blocks;c.addEventListener("keydown",(e=>{(({key:t},{blocks:e})=>{const o=e.textInput;"Enter"===t&&(o.blur(),o.focus()),"Escape"===t&&(o.value="")})(e,t)})),c.addEventListener("blur",(()=>{(({blocks:t,items:e})=>{const{textInput:o,itemsList:s}=t,i=(t=>{if(t.trim())return new l(t)})(o.value);i?(e.unshift(i),s.prepend(...n([e[0]])),o.value=""):o.value=""})(t),s(t),r(i,t),t.isShow||1!==t.items.length||o(t)})),a.addEventListener("click",(()=>{(({blocks:t,items:e})=>{const{itemsList:o}=t;e.map((t=>{t.isCompleted=!0})),Array.from(o.childNodes).forEach((t=>t.remove())),o.prepend(...n(e))})(t),s(t),r(i,t)})),d.addEventListener("click",(e=>{t.filter=(({target:t})=>{if(t.classList.contains("app__button")){const e=t.closest(".app__buttons");return Array.from(e.children).forEach((t=>t.classList.remove("app__button_active"))),t.classList.add("app__button_active"),t.href.split("#").pop()}})(e),i(t)})),m.addEventListener("click",(()=>{(({blocks:t,items:e})=>{const o=t.itemsList;e.splice(0,e.length,...e.filter((t=>!t.isCompleted))),Array.from(o.childNodes).forEach((t=>t.remove())),o.prepend(...n(e))})(t),s(t),i(t),t.isShow&&0===t.items.length&&o(t)})),(t=>{const{itemsList:e,buttons:r}=t.blocks,l=t.items;window.onbeforeunload=()=>{localStorage.setItem("states",JSON.stringify(t))},document.addEventListener("DOMContentLoaded",(()=>{if(!localStorage.getItem("states"))return;const c=JSON.parse(localStorage.getItem("states")),a=c.items;t.filter=c.filter,c.isShow&&o(t),l.unshift(...a),e.prepend(...n(l)),Array.from(r.children).forEach((e=>{e.classList.remove("app__button_active"),e.href.split("#").pop()===t.filter&&e.classList.add("app__button_active")})),s(t),i(t)}))})(t);const u={blocks:{ufo:document.querySelector(".ufo"),title:document.querySelector(".app__title"),setUfoColor(t){this.ufo.style.backgroundColor=t},setUfoPosition(t,e){const o=parseInt(getComputedStyle(this.ufo).width),s=parseInt(getComputedStyle(this.ufo).height);this.ufo.style.left=t-o/2+"px",this.ufo.style.top=e-s/2+"px"},setTitleColor(t){this.title.style.color=t}},countForStart:5,isShow:!1},{blocks:p}=u,{ufo:f,title:h}=p;let{countForStart:_,isShow:b}=u;f.addEventListener("click",(()=>{if(!b&&(_--,0===_)){document.body.classList.add("ufo-active"),(t=>{const o=e("div","stars");document.body.append(o);for(let t=0;t<400;t++){const t=e("div","stars__star");o.append(t)}})(),b=!b;const t=setInterval((()=>{let t="#"+Math.floor(16777215*Math.random()).toString(16);p.setUfoColor(t),p.setTitleColor(t)}),600);window.addEventListener("click",(t=>{p.setUfoPosition(t.pageX,t.pageY)})),setTimeout((()=>{f.addEventListener("dblclick",(()=>{clearInterval(t),f.style.zIndex="-1",f.style.opacity="0",f.style.cursor="auto",h.style.color="#C5D0E6",document.body.classList.remove("ufo-active"),document.querySelector(".stars").remove(),setTimeout((()=>{f.remove()}),1e3)}))}),2e3)}}))})();