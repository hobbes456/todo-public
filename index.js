(()=>{"use strict";const t={blocks:{header:document.querySelector(".app__header"),content:document.querySelector(".app__content"),footer:document.querySelector(".app__footer"),get textInput(){return this.header.querySelector("input")},get toggleAllInput(){return this.content.querySelector("#toggle-all")},get toggleAllButton(){return this.content.querySelector(".app__toggle-all")},get itemsList(){return this.content.querySelector(".app__items-list")},get itemsLeft(){return this.footer.querySelector("p")},get buttons(){return this.footer.querySelector(".app__buttons")},get clearButton(){return this.footer.querySelector(".app__clear-button")}},filter:"all",items:[],isShow:!1},e=t=>{const{content:e,footer:s}=t.blocks;[e,s].forEach((t=>t.classList.toggle(t.classList[0]+"_show"))),t.isShow=!t.isShow},s=t=>{const e=t.blocks.itemsList,s=t.filter;Array.from(e.childNodes).forEach((t=>{t.style.display="flex","active"===s?t.classList.contains("item_completed")&&(t.style.display="none"):"completed"===s&&(t.classList.contains("item_completed")||(t.style.display="none"))}))},o=e=>e.map((e=>(e=>{const s=((t,e)=>{const s=document.createElement("li");return s.classList.add("item"),s})();s.id=e.time,s.isCompleted=e.isCompleted,s.insertAdjacentHTML("afterbegin",'<div class="item__template">\n        <input id="item-checkbox" type="checkbox">\n        <label class="item__checkbox" for="item-checkbox"></label>\n        <label class="item__content"></label>\n        <button class="item__button" type="button">+</button>\n    </div>\n    <div class="item__edit">\n        <input type="text">\n    </div>');const o=s.querySelector("#item-checkbox"),i=s.querySelector(".item__checkbox"),l=s.querySelector(".item__content"),n=s.querySelector(".item__button"),c=s.querySelector(".item__edit input");return s.isCompleted&&(s.classList.add("item_completed"),o.checked=!0),o.id+=`_${e.time}`,i.htmlFor+=`_${e.time}`,l.textContent=e.text,i.addEventListener("click",(e=>{((t,e)=>{const s=t.target.closest(".item");s.classList.toggle("item_completed"),s.isCompleted=!s.isCompleted,e.items.filter((t=>t.time===parseInt(s.id))).forEach((t=>t.isCompleted=!t.isCompleted))})(e,t)})),l.addEventListener("dblclick",(t=>{(t=>{const e=t.target.closest(".item");e.classList.add("item_edited");const s=e.querySelector(".item__content"),o=e.querySelector(".item__edit input");o.value=s.textContent,o.focus()})(t)})),n.addEventListener("click",(e=>{((t,e)=>{const s=t.target.closest(".item");e.items.splice(0,e.items.length,...e.items.filter((t=>t.time!==parseInt(s.id)))),s.remove()})(e,t)})),c.addEventListener("blur",(e=>{((t,e)=>{const s=t.target,o=s.closest(".item");""===s.value.trim()?(e.items.splice(0,e.items.length,...e.items.filter((t=>t.time!==parseInt(o.id)))),o.remove()):(o.querySelector(".item__content").textContent=s.value,e.items.find((t=>t.time===parseInt(o.id))).text=s.value),o.classList.remove("item_edited")})(e,t)})),c.addEventListener("keydown",(t=>{(t=>{const{key:e,target:s}=t;if("Enter"===e&&s.blur(),"Escape"===e){const t=s.closest(".item").querySelector(".item__content");s.value=t.textContent,s.blur()}})(t)})),s})(e)));class i{constructor(t){this.isCompleted=!1,this.text=t,this.time=Date.now(),this.date=new Date}}const{textInput:l,toggleAllButton:n,buttons:c,clearButton:r}=t.blocks;(t=>{const{toggleAllInput:o,toggleAllButton:i,itemsList:l,itemsLeft:n}=t.blocks,c=new MutationObserver((c=>{const r=c[0].target.childNodes.length;let a=(t=>{let e=0;return t.forEach((t=>{!0===t.isCompleted&&e++})),t.length-e})(l.childNodes);(!1===t.isShow&&1===r||!0===t.isShow&&0===r)&&e(t),0===r&&(o.checked=!1),0===a?i.classList.add("app__toggle-all_completed"):i.classList.remove("app__toggle-all_completed"),n.textContent=1===a?`${a} item left`:`${a} items left`,s(t)}));c.observe(l,{childList:!0,subtree:!0,attributeFilter:["class"]})})(t),l.addEventListener("keydown",(e=>{((t,e)=>{const s=e.blocks.textInput,{key:o}=t;"Enter"===o&&(s.blur(),s.focus()),"Escape"===o&&(s.value="")})(e,t)})),l.addEventListener("blur",(()=>{(t=>{const{textInput:e,itemsList:s}=t.blocks,l=t.items,n=(t=>{if((t=>""!==t.trim())(t))return new i(t)})(e.value);n?(l.unshift(n),s.prepend(...o([l[0]])),e.value=""):e.value=""})(t)})),n.addEventListener("click",(()=>{(t=>{const{toggleAllInput:e,itemsList:s}=t.blocks,i=t.items;i.map((t=>{!0===e.checked?t.isCompleted=!1:t.isCompleted=!0})),Array.from(s.childNodes).forEach((t=>t.remove())),s.prepend(...o(i))})(t)})),c.addEventListener("click",(e=>{t.filter=(t=>{const e=t.target;if(e.classList.contains("app__button")){const t=e.closest(".app__buttons");return Array.from(t.children).forEach((t=>t.classList.remove("app__button_active"))),e.classList.add("app__button_active"),e.href.split("#").pop()}})(e),s(t)})),r.addEventListener("click",(()=>{(t=>{const e=t.blocks.itemsList,s=t.items;s.splice(0,s.length,...s.filter((t=>!0!==t.isCompleted))),Array.from(e.childNodes).forEach((t=>t.remove())),e.prepend(...o(s))})(t)})),(t=>{const{itemsList:i,buttons:l}=t.blocks,n=t.items;window.onbeforeunload=()=>{localStorage.setItem("states",JSON.stringify(t))},document.addEventListener("DOMContentLoaded",(()=>{if(!localStorage.getItem("states"))return;const c=JSON.parse(localStorage.getItem("states")),r=c.items;t.filter=c.filter,c.isShow&&e(t),n.unshift(...r),i.prepend(...o(n)),Array.from(l.children).forEach((e=>{e.classList.remove("app__button_active"),e.href.split("#").pop()===t.filter&&e.classList.add("app__button_active")})),s(t)}))})(t)})();