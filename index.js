(()=>{"use strict";const t={blocks:{header:document.querySelector(".app__header"),content:document.querySelector(".app__content"),footer:document.querySelector(".app__footer"),get textInput(){return this.header.querySelector("input")},get toggleAllInput(){return this.content.querySelector("#toggle-all")},get toggleAllButton(){return this.content.querySelector(".app__toggle-all")},get itemsList(){return this.content.querySelector(".app__items-list")},get itemsLeft(){return this.footer.querySelector("p")},get buttons(){return this.footer.querySelector(".app__buttons")},get clearButton(){return this.footer.querySelector(".app__clear-button")}},filter:"all",items:[],isShow:!1},e=t=>{const{content:e,footer:o}=t.blocks;[e,o].forEach((t=>t.classList.toggle(t.classList[0]+"_show"))),t.isShow=!t.isShow},o=t=>{const e=t.blocks.itemsList,o=t.filter;Array.from(e.childNodes).forEach((t=>{t.style.display="flex","active"===o?t.classList.contains("item_completed")&&(t.style.display="none"):"completed"===o&&(t.classList.contains("item_completed")||(t.style.display="none"))}))},s=(t,e)=>{const o=document.createElement(t);return o.classList.add(e),o},i=e=>e.map((e=>(e=>{const o=s("li","item");o.id=e.time,o.isCompleted=e.isCompleted,o.insertAdjacentHTML("afterbegin",'<div class="item__template">\n        <input id="item-checkbox" type="checkbox">\n        <label class="item__checkbox" for="item-checkbox"></label>\n        <label class="item__content"></label>\n        <button class="item__button" type="button">+</button>\n    </div>\n    <div class="item__edit">\n        <input type="text">\n    </div>');const i=o.querySelector("#item-checkbox"),l=o.querySelector(".item__checkbox"),n=o.querySelector(".item__content"),r=o.querySelector(".item__button"),c=o.querySelector(".item__edit input");return o.isCompleted&&(o.classList.add("item_completed"),i.checked=!0),i.id+=`_${e.time}`,l.htmlFor+=`_${e.time}`,n.textContent=e.text,l.addEventListener("click",(e=>{((t,e)=>{const o=t.target.closest(".item");o.classList.toggle("item_completed"),o.isCompleted=!o.isCompleted,e.items.filter((t=>t.time===parseInt(o.id))).forEach((t=>t.isCompleted=!t.isCompleted))})(e,t)})),n.addEventListener("dblclick",(t=>{(t=>{const e=t.target.closest(".item");e.classList.add("item_edited");const o=e.querySelector(".item__content"),s=e.querySelector(".item__edit input");s.value=o.textContent,s.focus()})(t)})),r.addEventListener("click",(e=>{((t,e)=>{const o=t.target.closest(".item");e.items.splice(0,e.items.length,...e.items.filter((t=>t.time!==parseInt(o.id)))),o.remove()})(e,t)})),c.addEventListener("blur",(e=>{((t,e)=>{const o=t.target,s=o.closest(".item");""===o.value.trim()?(e.items.splice(0,e.items.length,...e.items.filter((t=>t.time!==parseInt(s.id)))),s.remove()):(s.querySelector(".item__content").textContent=o.value,e.items.find((t=>t.time===parseInt(s.id))).text=o.value),s.classList.remove("item_edited")})(e,t)})),c.addEventListener("keydown",(t=>{(t=>{const{key:e,target:o}=t;if("Enter"===e&&o.blur(),"Escape"===e){const t=o.closest(".item").querySelector(".item__content");o.value=t.textContent,o.blur()}})(t)})),o})(e)));class l{constructor(t){this.isCompleted=!1,this.text=t,this.time=Date.now(),this.date=new Date}}const{textInput:n,toggleAllButton:r,buttons:c,clearButton:a}=t.blocks;(t=>{const{toggleAllInput:s,toggleAllButton:i,itemsList:l,itemsLeft:n}=t.blocks,r=new MutationObserver((r=>{const c=r[0].target.childNodes.length;let a=(t=>{let e=0;return t.forEach((t=>{!0===t.isCompleted&&e++})),t.length-e})(l.childNodes);(!1===t.isShow&&1===c||!0===t.isShow&&0===c)&&e(t),0===c&&(s.checked=!1),0===a?i.classList.add("app__toggle-all_completed"):i.classList.remove("app__toggle-all_completed"),n.textContent=1===a?`${a} item left`:`${a} items left`,o(t)}));r.observe(l,{childList:!0,subtree:!0,attributeFilter:["class"]})})(t),n.addEventListener("keydown",(e=>{((t,e)=>{const o=e.blocks.textInput,{key:s}=t;"Enter"===s&&(o.blur(),o.focus()),"Escape"===s&&(o.value="")})(e,t)})),n.addEventListener("blur",(()=>{(t=>{const{textInput:e,itemsList:o}=t.blocks,s=t.items,n=(t=>{if((t=>""!==t.trim())(t))return new l(t)})(e.value);n?(s.unshift(n),o.prepend(...i([s[0]])),e.value=""):e.value=""})(t)})),r.addEventListener("click",(()=>{(t=>{const{toggleAllInput:e,itemsList:o}=t.blocks,s=t.items;s.map((t=>{!0===e.checked?t.isCompleted=!1:t.isCompleted=!0})),Array.from(o.childNodes).forEach((t=>t.remove())),o.prepend(...i(s))})(t)})),c.addEventListener("click",(e=>{t.filter=(t=>{const e=t.target;if(e.classList.contains("app__button")){const t=e.closest(".app__buttons");return Array.from(t.children).forEach((t=>t.classList.remove("app__button_active"))),e.classList.add("app__button_active"),e.href.split("#").pop()}})(e),o(t)})),a.addEventListener("click",(()=>{(t=>{const e=t.blocks.itemsList,o=t.items;o.splice(0,o.length,...o.filter((t=>!0!==t.isCompleted))),Array.from(e.childNodes).forEach((t=>t.remove())),e.prepend(...i(o))})(t)})),(t=>{const{itemsList:s,buttons:l}=t.blocks,n=t.items;window.onbeforeunload=()=>{localStorage.setItem("states",JSON.stringify(t))},document.addEventListener("DOMContentLoaded",(()=>{if(!localStorage.getItem("states"))return;const r=JSON.parse(localStorage.getItem("states")),c=r.items;t.filter=r.filter,r.isShow&&e(t),n.unshift(...c),s.prepend(...i(n)),Array.from(l.children).forEach((e=>{e.classList.remove("app__button_active"),e.href.split("#").pop()===t.filter&&e.classList.add("app__button_active")})),o(t)}))})(t);const d={blocks:{ufo:document.querySelector(".ufo"),title:document.querySelector(".app__title"),setUfoColor(t){this.ufo.style.backgroundColor=t},setUfoPosition(t,e){const o=parseInt(getComputedStyle(this.ufo).width),s=parseInt(getComputedStyle(this.ufo).height);this.ufo.style.left=t-o/2+"px",this.ufo.style.top=e-s/2+"px"},setTitleColor(t){this.title.style.color=t}},countForStart:5,isShow:!1},{blocks:m}=d,{ufo:u,title:p}=m;let{countForStart:_,isShow:h}=d;u.addEventListener("click",(()=>{if(!h&&(_--,0===_)){document.body.classList.add("ufo-active"),(t=>{const e=s("div","stars");document.body.append(e);for(let t=0;t<400;t++){const t=s("div","stars__star");e.append(t)}})(),h=!h;const t=setInterval((()=>{let t="#"+Math.floor(16777215*Math.random()).toString(16);m.setUfoColor(t),m.setTitleColor(t)}),600);window.addEventListener("click",(t=>{m.setUfoPosition(t.pageX,t.pageY)})),setTimeout((()=>{u.addEventListener("dblclick",(()=>{clearInterval(t),u.style.zIndex="-1",u.style.opacity="0",u.style.cursor="auto",p.style.color="#C5D0E6",document.body.classList.remove("ufo-active"),document.querySelector(".stars").remove(),setTimeout((()=>{u.remove()}),1e3)}))}),2e3)}}))})();